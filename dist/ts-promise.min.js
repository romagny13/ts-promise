/*!
 * TSPromise v1.0.2
 * (c) 2017 romagny13
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TSPromise=e()}(this,function(){"use strict";function t(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function e(t){return"function"==typeof t}function n(t,e){t._result=e;var n=t._stack.next(r.onResolved);n?n.fn():t._state=i.waitOnResolvedCallback}function o(t,e){t._reason=e;var n=t._stack.next(r.onRejected);n?n.fn():t._state=i.waitOnRejectedCallback}function c(t,n,o,c){function s(){try{var e=o(t._result);n._child.resolve(e)}catch(t){n._child.reject(t)}}function u(){try{var e=c(t._reason);n._child.resolve(e)}catch(t){n._child.reject(t)}}var a=e(o),f=e(c);if(n._child=new l(t),a&&t._stack.push(r.onResolved,function(){s()}),f&&t._stack.push(r.onRejected,function(){u()}),a&&t._state===i.waitOnResolvedCallback){var h=t._stack.next(r.onResolved);h&&h.fn()}else if(f&&t._state===i.waitOnRejectedCallback){var h=t._stack.next(r.onRejected);h&&h.fn()}return n._child}var r;!function(t){t[t.onResolved=0]="onResolved",t[t.onRejected=1]="onRejected"}(r||(r={}));var i,s=function(){function t(t,e){this.type=t,this.fn=e}return t}(),u=function(){function t(){this._stack=[]}return t.prototype._getNextItemIndex=function(t){for(var e=this._stack.length,n=0;n<e;n++){var o=this._stack[n];if(o.type===t)return n}return-1},t.prototype._splice=function(t){this._stack.splice(0,t)},t.prototype.clear=function(){this._stack=[]},t.prototype.push=function(t,e){this._stack.push(new s(t,e))},t.prototype.next=function(t){var e=this._getNextItemIndex(t);return e!==-1?this._splice(e):this.clear(),this._stack.shift()},t}();!function(t){t[t.completed=0]="completed",t[t.waitOnResolvedCallback=1]="waitOnResolvedCallback",t[t.waitOnRejectedCallback=2]="waitOnRejectedCallback"}(i||(i={}));var a=function(){function t(){}return t}(),f=function(r){function i(t){var n=r.call(this)||this;n._stack=new u;try{e(t)&&t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}return n}return t(i,r),i.prototype.resolve=function(t){n(this,t)},i.prototype.reject=function(t){o(this,t)},i.prototype.then=function(t,e){return c(this,this,t,e)},i.prototype.catch=function(t){return c(this,this,null,t)},i.all=function(t){for(var e=[],n=!1,o=t.length,c=0,r=new i,s=0;s<o;s++){var u=t[s];try{u.then(function(t){n||(e.push(t),c++,c===o&&(n=!0,r.resolve(e)))},function(t){n||(n=!0,r.reject(t))})}catch(t){n=!0,r.reject(t)}}return r},i.race=function(t){for(var e=!1,n=t.length,o=new i,c=0;c<n;c++){var r=t[c];try{r.then(function(t){e||(e=!0,o.resolve(t))},function(t){e||(e=!0,o.reject(t))})}catch(t){e=!0,o.reject(t)}}return o},i}(a),l=function(e){function r(t){var n=e.call(this)||this;return n._root=t,n}return t(r,e),r.prototype.resolve=function(t){n(this._root,t)},r.prototype.reject=function(t){o(this._root,t)},r.prototype.then=function(t,e){return c(this._root,this,t,e)},r.prototype.catch=function(t){return c(this._root,this,null,t)},r}(a);return f});
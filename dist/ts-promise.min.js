/*!
 * TSPromise v0.0.4
 * (c) 2017 romagny13
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TSPromise=e()}(this,function(){"use strict";function t(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function e(t){return"function"==typeof t}function i(t,e){var i=new a(null,e);return i._parent=t,i}var n,o=function(){function t(){this._cache={},this._cacheSize=100}return t.prototype._generateKey=function(){return"__p_"+Math.random().toString(36).substr(2,9)},t.prototype._retrieve=function(t){if(this._cache.hasOwnProperty(t))return this._cache[t]},t.prototype._checkCacheSize=function(){this._currentSize===this._cacheSize&&this.clear()},t.prototype.getNewId=function(){this._checkCacheSize();var t=this._generateKey(),e=t+".0";return this._cache[t]=[e],this._currentSize++,e},t.prototype.getId=function(t){if("string"==typeof t){var e=t.split(".")[0],i=this._retrieve(e);if(i){var n=e+"."+i.length;return this._cache[e].push(n),n}}return this.getNewId()},t.prototype.clear=function(){this._cache={},this._currentSize=0},t}(),s=new o;!function(t){t[t.waitCompleteCallBack=0]="waitCompleteCallBack",t[t.waitRejectionCallBack=1]="waitRejectionCallBack",t[t.waitResolveOrReject=2]="waitResolveOrReject",t[t.completed=3]="completed",t[t.none=4]="none"}(n||(n={}));var r;!function(t){t[t.all=0]="all",t[t.race=1]="race"}(r||(r={}));var c=function(){function t(){}return t.prototype._doComplete=function(t){try{this._pending=void 0,this._state=n.completed;var e=this._onComplete(t);this._child.resolve(e)}catch(t){this._child.reject(t)}},t.prototype._doRejection=function(t){try{this._pending=void 0,this._state=n.completed;var e=this._onReject(t);this._child.resolve(e)}catch(t){this._child.reject(t)}},t.prototype._setPending=function(t,e){this._state=t,this._pending=e},t.prototype.resolve=function(t){this._onComplete?this._doComplete(t):this._setPending(n.waitCompleteCallBack,t)},t.prototype.reject=function(t){this._onReject?this._doRejection(t):this._setPending(n.waitRejectionCallBack,t)},t}(),h=function(o){function c(t,e){var i=o.call(this)||this;return i._id=s.getNewId(),i._promiseResults=[],i._pendingNotify=[],i._mode=e,i._promises=t,i._mode===r.all?i._iteratePromises(t):i._mode===r.race&&i._race(t),i}return t(c,o),c.prototype._notifyPendings=function(){var t=this;this._pendingNotify.length>0&&(this._pendingNotify.forEach(function(e){t._onNotify(e)}),this._pendingNotify=[])},c.prototype._doNotification=function(t){this._onNotify?this._onNotify(t):this._pendingNotify.push(t)},c.prototype._nextPromise=function(t,e,i,n){var o=this;t.then(function(t){o._doNotification(t),t&&o._promiseResults.push(t),i++,i<n?o._nextPromise(e[i],e,i,n):o.resolve(o._promiseResults)},function(t){o.reject(t)})},c.prototype._iteratePromises=function(t){var e=t.length,i=0;e>0?this._nextPromise(t[0],t,i,e):this.resolve([])},c.prototype._race=function(t){var e=this;t.forEach(function(t){t.then(function(t){e._state!==n.completed&&(t&&e._promiseResults.push(t),e.resolve(t))},function(t){e.reject(t)})})},c.prototype.then=function(t,o,s){return this._child=i(this,this._id),this._onComplete=t,this._onReject=o,this._onNotify=s,e(this._onNotify)&&this._notifyPendings(),this._state===n.waitCompleteCallBack?this._doComplete(this._promiseResults):this._state===n.waitRejectionCallBack?e(this._onReject)&&this._doRejection(this._pending):this._state=n.waitResolveOrReject,this._child},c.prototype.catch=function(t){return this.then(this._onComplete,t,this._onNotify)},c}(c),a=function(o){function c(t,i){var n=o.call(this)||this;if(i?n._id=s.getId(i):n._id=s.getNewId(),e(t))try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}return n}return t(c,o),c.prototype.then=function(t,o){return this._child=i(this,this._id),this._onComplete=t,this._onReject=o,this._state===n.waitCompleteCallBack?this._doComplete(this._pending):this._state===n.waitRejectionCallBack?e(this._onReject)&&this._doRejection(this._pending):this._state=n.waitResolveOrReject,this._child},c.prototype.catch=function(t){return this._parent._state===n.completed?this.then(this._onComplete,t):this._parent.then(this._onComplete,t)},c.all=function(t){return new h(t,r.all)},c.race=function(t){return new h(t,r.race)},c}(c);return a});
/*!
 * TSPromise v1.0.0
 * (c) 2017 romagny13
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TSPromise=e()}(this,function(){"use strict";function t(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function e(t){return"function"==typeof t}var n;!function(t){t[t.completed=0]="completed",t[t.waitOnResolvedCallback=1]="waitOnResolvedCallback",t[t.waitOnRejectedCallback=2]="waitOnRejectedCallback"}(n||(n={}));var o;!function(t){t[t.onResolved=0]="onResolved",t[t.onRejected=1]="onRejected"}(o||(o={}));var r=function(){function t(t,e){this.type=t,this.fn=e}return t}(),c=function(){function t(){this._stack=[]}return t.prototype._getNextItemIndex=function(t){for(var e=this._stack.length,n=0;n<e;n++){var o=this._stack[n];if(o.type===t)return n}return-1},t.prototype._splice=function(t){this._stack.splice(0,t)},t.prototype.clear=function(){this._stack=[]},t.prototype.push=function(t,e){this._stack.push(new r(t,e))},t.prototype.next=function(t){var e=this._getNextItemIndex(t);return e!==-1?this._splice(e):this.clear(),this._stack.shift()},t}(),i=function(){function t(t){var n=this;this._root=this,this._stack=new c;try{e(t)&&t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){this.reject(t)}}return t.prototype.resolve=function(t){this._root._result=t;var e=this._root._stack.next(o.onResolved);e?e.fn():this._root._state=n.waitOnResolvedCallback},t.prototype.reject=function(t){this._root._reason=t;var e=this._root._stack.next(o.onRejected);e?e.fn():this._root._state=n.waitOnRejectedCallback},t.prototype.then=function(t,r){function c(){try{var e=t(a._root._result);a._child.resolve(e)}catch(t){a._child.reject(t)}}function i(){try{var t=r(a._root._reason);a._child.resolve(t)}catch(t){a._child.reject(t)}}this._child=new s(this._root);var a=this;if(e(t)&&this._root._stack.push(o.onResolved,function(){c()}),e(r)&&this._root._stack.push(o.onRejected,function(){i()}),e(t)&&this._root._state===n.waitOnResolvedCallback){var u=this._root._stack.next(o.onResolved);u&&u.fn()}else if(r&&this._root._state===n.waitOnRejectedCallback){var u=this._root._stack.next(o.onRejected);u&&u.fn()}return this._child},t.prototype.catch=function(t){return this.then(null,t)},t.all=function(e){for(var n=[],o=!1,r=e.length,c=0,i=new t,s=0;s<r;s++){var a=e[s];try{a.then(function(t){o||(n.push(t),c++,c===r&&(o=!0,i.resolve(n)))},function(t){o||(o=!0,i.reject(t))})}catch(t){o=!0,i.reject(t)}}return i},t.race=function(e){for(var n=!1,o=e.length,r=new t,c=0;c<o;c++){var i=e[c];try{i.then(function(t){n||(n=!0,r.resolve(t))},function(t){n||(n=!0,r.reject(t))})}catch(t){n=!0,r.reject(t)}}return r},t}(),s=function(e){function n(t){var n=e.call(this)||this;return n._root=t,n}return t(n,e),n}(i);return i});
/*!
 * TSPromise v0.0.5
 * (c) 2017 romagny13
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TSPromise=e()}(this,function(){"use strict";function t(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function e(t){return"undefined"!=typeof t}function i(t){return"function"==typeof t}function n(t,e){var i=new _(null,e);return i._parent=t,i}var o,r=function(){function t(){this._cache={},this._cacheSize=100}return t.prototype._generateKey=function(){return"__p_"+Math.random().toString(36).substr(2,9)},t.prototype._retrieve=function(t){if(this._cache.hasOwnProperty(t))return this._cache[t]},t.prototype._checkCacheSize=function(){this._currentSize===this._cacheSize&&this.clear()},t.prototype.getNewId=function(){this._checkCacheSize();var t=this._generateKey(),e=t+".0";return this._cache[t]=[e],this._currentSize++,e},t.prototype.getId=function(t){if("string"==typeof t){var e=t.split(".")[0],i=this._retrieve(e);if(i){var n=e+"."+i.length;return this._cache[e].push(n),n}}return this.getNewId()},t.prototype.clear=function(){this._cache={},this._currentSize=0},t}(),s=new r;!function(t){t[t.waitCompleteCallBack=0]="waitCompleteCallBack",t[t.waitRejectionCallBack=1]="waitRejectionCallBack",t[t.waitResolveOrReject=2]="waitResolveOrReject",t[t.completed=3]="completed",t[t.none=4]="none"}(o||(o={}));var c;!function(t){t[t.all=0]="all",t[t.race=1]="race"}(c||(c={}));var h=function(){function t(){}return t.prototype._doComplete=function(t){try{this._pending=void 0,this._state=o.completed;var e=this._onComplete(t);this._child.resolve(e)}catch(t){this._child.reject(t)}},t.prototype._doRejection=function(t){try{this._pending=void 0,this._state=o.completed;var e=this._onReject(t);this._child.resolve(e)}catch(t){this._child.reject(t)}},t.prototype._setPending=function(t,e){this._state=t,this._pending=e},t.prototype.resolve=function(t){this._onComplete?this._doComplete(t):this._setPending(o.waitCompleteCallBack,t)},t.prototype.reject=function(t){this._onReject?this._doRejection(t):this._setPending(o.waitRejectionCallBack,t)},t}(),a=function(r){function h(t,e){var i=r.call(this)||this;return i._id=s.getNewId(),i._promiseResults=[],i._pendingNotify=[],i._mode=e,i._promises=t,i._mode===c.all?i._iteratePromises(t):i._mode===c.race&&i._race(t),i}return t(h,r),h.prototype._notifyPendings=function(){var t=this;this._pendingNotify.length>0&&(this._pendingNotify.forEach(function(e){t._onNotify(e)}),this._pendingNotify=[])},h.prototype._doNotification=function(t){this._onNotify?this._onNotify(t):this._pendingNotify.push(t)},h.prototype._nextPromise=function(t,i,n,o){var r=this;t.then(function(t){r._doNotification(t),e(t)&&r._promiseResults.push(t),n++,n<o?r._nextPromise(i[n],i,n,o):r.resolve(r._promiseResults)},function(t){r.reject(t)})},h.prototype._iteratePromises=function(t){var e=t.length,i=0;e>0?this._nextPromise(t[0],t,i,e):this.resolve([])},h.prototype._race=function(t){var i=this;t.forEach(function(t){t.then(function(t){i._state!==o.completed&&(e(t)&&i._promiseResults.push(t),i.resolve(t))},function(t){i.reject(t)})})},h.prototype.then=function(t,e,r){return this._child=n(this,this._id),this._onComplete=t,this._onReject=e,this._onNotify=r,i(this._onNotify)&&this._notifyPendings(),this._state===o.waitCompleteCallBack?this._doComplete(this._promiseResults):this._state===o.waitRejectionCallBack?i(this._onReject)&&this._doRejection(this._pending):this._state=o.waitResolveOrReject,this._child},h.prototype.catch=function(t){return this.then(this._onComplete,t,this._onNotify)},h}(h),_=function(e){function r(t,n){var o=e.call(this)||this;if(n?o._id=s.getId(n):o._id=s.getNewId(),i(t))try{t(function(t){o.resolve(t)},function(t){o.reject(t)})}catch(t){o.reject(t)}return o}return t(r,e),r.prototype.then=function(t,e){return this._child=n(this,this._id),this._onComplete=t,this._onReject=e,this._state===o.waitCompleteCallBack?this._doComplete(this._pending):this._state===o.waitRejectionCallBack?i(this._onReject)&&this._doRejection(this._pending):this._state=o.waitResolveOrReject,this._child},r.prototype.catch=function(t){return this._parent._state===o.completed?this.then(this._onComplete,t):this._parent.then(this._onComplete,t)},r.all=function(t){return new a(t,c.all)},r.race=function(t){return new a(t,c.race)},r}(h);return _});